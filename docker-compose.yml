version: '2.3'
services:
  node-screenshots:
    container_name: node-screenshots
    image: valentinvieriu/node-screenshots:1.3.0
    init: true
    build: .
    # privileged: true
    restart: 'unless-stopped'
    cap_add: 
      - 'SYS_ADMIN'
    # user: pptruser
    shm_size: 2G
    restart: always
    mem_limit: 1G
    memswap_limit: 2G
    environment:
      FILES_CLEAN_TIMEOUT: '${FILES_CLEAN_TIMEOUT}'
      WATCH_QUEUE: ${WATCH_QUEUE}
      WAIT_UNTIL: 'networkidle0'
      NODE_ENV: ${NODE_ENV}
      REDIS_URL: ${REDIS_URL}
      PORT: ${PORT}
      CHROME_PATH: "${CHROME_PATH}"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:${PORT}/healthcheck"]
      interval: 1m
      timeout: 10s
      retries: 3
    labels:
      - "traefik.port=${PORT}"
      - "traefik.frontend.rule=Host:node-screenshots.${TLD}"
    ports:
      - '${PORT}:${PORT}'
      - '9222:9222'
    volumes: 
      - ${ROOT_FOLDER}/screenshots:/usr/src/app/screenshots